name: CI build

on: [push]

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        version:
          - 5.15.2
          
        platform:
          # - gcc_64
          # - android
          # - msvc2019
          # - msvc2019_64
          # - mingw81_32
          # - clang_64
          - mingw81_64

        include:
#           - platform: gcc_64
#             os: ubuntu-latest
#           - platform: android
#             os: ubuntu-latest
#           - platform: msvc2019
#             os: windows-latest
#           - platform: mingw81_32
#             os: windows-latest
#             ver: win32_mingw81
#           - platform: mingw81_64
#             os: windows-latest
#             arch: win64_mingw81
#             spec: win32-mingw
#           - platform: clang_64
#             os: macos-latest
          - platform: msvc2019_64
            os: windows-latest
            arch: win64_msvc2019_64
            spec: win32-msvc
            
    runs-on: ${{matrix.os}}
    steps:
      - name: checkout
        uses: actions/checkout@v1
        with:
          submodules: recursive
      - uses: actions/setup-python@v1
      
      - name: Install Qt
        uses: jurplel/install-qt-action@v2.13.0
        with:
          version: ${{ matrix.version }}
          arch:    ${{ env.arch }}
          extra:   --external 7z
          
#       - name: Find String
#         id: fstr
#         uses: nguyenvanuyn96/str-find-action@master
#         with:
#           find: "^.*qml"
      
      - name: build
        run: |
          qmake && make
      - name: upload module to releases
        uses: Skycoder42/action-upload-release@master
        with:
          repo_token: ${{secrets.GITHUB_TOKEN}}
          platform: ${{matrix.platform}}
          asset_name: test-${{matrix.platform}}-${{matrix.version}}
          tag: 'v0.0.1'
          overwrite: true 
#   deploy:
#     if: startsWith(github.ref, 'refs/tags/')
#     needs: build
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v1
#         with:
#           submodules: recursive
#           path: source
#       - uses: actions/setup-python@v1
#       - uses: Skycoder42/action-deploy-qt@master
#         with:
#           token: ${{secrets.GITHUB_TOKEN}}
#           version: 5.15.2
#           host: ${{secrets.SSHFS_HOST}}
#           key: ${{secrets.SSHFS_KEY}}
#           port: ${{secrets.SSHFS_PORT}} 
